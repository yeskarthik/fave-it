chrome.tabs.onUpdated.addListener(function(e,o,r){console.log(o),-1==r.url.indexOf("http://www.facebook.com/")&&-1==r.url.indexOf("https://www.facebook.com/")||"complete"!==o.status||chrome.tabs.executeScript(e,{file:"reload.js"})}),chrome.webRequest.onCompleted.addListener(function(e){var o=document.createElement("a");o.href=e.url,o.search&&-1!==o.search.indexOf("ajaxpipe=1")&&chrome.tabs.executeScript(e.tabId,{file:"reload.js"})},{urls:["*://*.facebook.com/*"]});var bookmarksFolderId=null,bookmarksFolderName="Facebook Favs";chrome.bookmarks.search(bookmarksFolderName,function(e){e.length>0?bookmarksFolderId=e[0].id:chrome.bookmarks.search("Bookmarks Bar",function(e){chrome.bookmarks.create({parentId:e[0].id,title:bookmarksFolderName},function(e){bookmarksFolderId=e.id})})}),chrome.runtime.onMessage.addListener(function(e,o,r){if("addFbBookmark"===e.action)e.link?(chrome.bookmarks.search(e.link,function(o){0===o.length&&chrome.bookmarks.create({parentId:bookmarksFolderId,title:e.username+": "+e.content,url:e.link})}),r({bookmarkCreate:"success"})):r({bookmarkCreate:"fail"});else if("checkIfBookmarkExists"===e.action){if(e.link)return chrome.bookmarks.search(e.link,function(e){r({exists:e.length>0,nodes:e})}),!0;r({exists:!1})}else"removeFbBookmark"===e.action&&(e.id?(chrome.bookmarks.remove(e.id),r({bookmarkDelete:"success"})):r({bookmarkDelete:"fail"}))});
